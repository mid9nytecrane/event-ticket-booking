{% extends "core/base.html" %}
{% load i18n allauth %}
{% block head_title %}
    {% if token_fail %}{% trans "Invalid Token" %}{% else %}{% trans "Change Password" %}{% endif %}
{% endblock head_title %}

{% block content %}
<div class="min-h-screen flex items-center justify-center px-4">
    <div class="max-w-sm w-full">
        <!-- Header -->
        <div class="text-center mb-6">
            <h1 class="text-xl font-medium text-gray-900">
                {% if token_fail %}
                    {% trans "Invalid Link" %}
                {% else %}
                    {% trans "Set New Password" %}
                {% endif %}
            </h1>
        </div>

        <!-- Content -->
        <div class="space-y-6">
            {% if token_fail %}
                <!-- Error Message -->
                <div class="text-center space-y-4">
                    <div class="text-red-600">
                        {% url 'account_reset_password' as passwd_reset_url %}
                        {% blocktrans %}This password reset link is invalid. Please request a <a href="{{ passwd_reset_url }}" class="underline">new password reset</a>.{% endblocktrans %}
                    </div>
                    <div>
                        <a href="{% url 'account_login' %}" class="text-sm text-gray-600 hover:text-gray-900">
                            ‚Üê {% trans "Back to Sign In" %}
                        </a>
                    </div>
                </div>
            {% else %}
                <!-- Form -->
                {% element form method="post" action=action_url %}
                    {% slot body %}
                        {% csrf_token %}
                        {{ redirect_field }}
                        
                        <div class="space-y-4">
                            <div>
                                <input type="password" 
                                       name="password1" 
                                       placeholder="{% trans 'New Password' %}"
                                       required
                                       class="w-full px-3 py-2 border border-gray-300 rounded">
                            </div>
                            <div>
                                <input type="password" 
                                       name="password2" 
                                       placeholder="{% trans 'Confirm Password' %}"
                                       required
                                       class="w-full px-3 py-2 border border-gray-300 rounded">
                            </div>
                        </div>
                    {% endslot %}
                    
                    {% slot actions %}
                        <div class="mt-6 space-y-3">
                            <button type="submit" 
                                    name="action"
                                    class="w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700">
                                {% trans 'Change Password' %}
                            </button>
                            <button type="submit" 
                                    form="logout-from-stage"
                                    class="w-full border border-gray-300 py-2 rounded hover:bg-gray-50">
                                {% trans "Cancel" %}
                            </button>
                        </div>
                    {% endslot %}
                {% endelement %}
            {% endif %}
        </div>
    </div>
</div>

<!-- Hidden Logout Form -->
{% if not cancel_url %}
<form id="logout-from-stage"
      method="post"
      action="{% url 'account_logout' %}">
    <input type="hidden" name="next" value="{% url 'account_login' %}">
    {% csrf_token %}
</form>
{% endif %}
{% endblock content %}